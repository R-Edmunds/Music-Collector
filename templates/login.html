{% extends 'base.html' %}

{% block head %}
<!-- <meta name="google-signin-client_id" content="738961851559-op16iihovld1kir48n3mrqc6640i49ll.apps.googleusercontent.com"> -->

<!-- BEGIN Pre-requisites -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
</script>
<script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
</script>
<!-- END Pre-requisites -->

<!-- Continuing the <head> section -->
  <script>
    function start() {
      gapi.load('auth2', function() {
        auth2 = gapi.auth2.init({
          client_id: '738961851559-op16iihovld1kir48n3mrqc6640i49ll.apps.googleusercontent.com',
          // Scopes to request in addition to 'profile' and 'email'
          scope: 'openid email'
        });
      });
    }
  </script>
{% endblock %}


{% block content %}

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
  <div class="">
    <br>

    {% block header %}
    <h2>{% block title %}Login{% endblock %}</h2>
    {% endblock %}

    <br>


    <form method="POST">
      <div class="form-group">
        <label for="email">Email address</label>
        <input type="email" class="form-control" name="email" aria-describedby="emailHelp" placeholder="Enter email">
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" class="form-control" name="password" placeholder="Password">
      </div>

      <br>

      <div class="form-group row">
        <div class="col-sm-10">
          <button type="submit" class="btn btn-primary">Login</button>
          <a href="{{ url_for('landingPage') }}" class="btn btn-danger">Cancel</a>
        </div>


      </div>


    </form>



    <div class="">

      <p>Put Google and Facebook OAuth2 buttons here</p>

      <!-- GOOGLE PLUS SIGN IN-->

      <!-- Add where you want your sign-in button to render -->
      <!-- Use an image that follows the branding guidelines in a real app -->
      <button id="signinButton">Sign in with Google</button>
      <script>
        $('#signinButton').click(function() {
          // signInCallback defined in step 6.
          auth2.grantOfflineAccess().then(signInCallback);
        });
      </script>

      <!-- Last part of BODY element in file index.html -->
      <script>
      function signInCallback(authResult) {
        if (authResult['code']) {

          // Hide the sign-in button now that the user is authorized, for example:
          $('#signinButton').attr('style', 'display: none');

          // Send the code to the server
          $.ajax({
            type: 'POST',
            url: 'http://localhost:8000/oauth2/google',
            // Always include an `X-Requested-With` header in every AJAX request,
            // to protect against CSRF attacks.
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            },
            contentType: 'application/octet-stream; charset=utf-8',
            success: function(result) {
              // Handle or verify the server response.
            },
            processData: false,
            data: authResult['code']
          });
        } else {
          // There was an error.
        }
      }
      </script>

      <!--END GOOGLE PLUS SIGN IN -->

    </div>

  </div>
</main>

{% endblock %}
